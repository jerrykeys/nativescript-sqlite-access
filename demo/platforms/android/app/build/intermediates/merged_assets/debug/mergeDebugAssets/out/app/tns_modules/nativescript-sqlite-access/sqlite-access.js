"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var SqliteAccess = /** @class */ (function () {
    function SqliteAccess(db) {
        this._db = db;
    }
    SqliteAccess.prototype.insert = function (table, values) {
        return this._db.insert(table, null, __mapToContentValues(values));
    };
    SqliteAccess.prototype.replace = function (table, values) {
        return this._db.replace(table, null, __mapToContentValues(values));
    };
    SqliteAccess.prototype.update = function (table, values, whereClause, whereArs) {
        return this._db.update(table, __mapToContentValues(values), whereClause, __objectArrayToStringArray(whereArs));
    };
    SqliteAccess.prototype.delete = function (table, whereClause, whereArs) {
        return this._db.delete(table, whereClause, __objectArrayToStringArray(whereArs));
    };
    SqliteAccess.prototype.select = function (sql, params) {
        var me = this;
        return new Promise(function (resolve, error) {
            var cursor = me._db.rawQuery(sql, __objectArrayToStringArray(params));
            try {
                var toArrayOfObject = __processCursor(cursor);
                var result = toArrayOfObject();
                resolve(result);
            }
            catch (ex) {
                error(ex);
            }
        });
    };
    SqliteAccess.prototype.query = function (table, columns, selection, selectionArgs, groupBy, orderBy, limit) {
        var me = this;
        return new Promise(function (resolve, error) {
            var cursor = me._db.query(table, columns, selection, __objectArrayToStringArray(selectionArgs), groupBy, orderBy, limit);
            try {
                var toArrayOfObject = __processCursor(cursor);
                var result = toArrayOfObject();
                resolve(result);
            }
            catch (ex) {
                error(ex);
            }
        });
    };
    SqliteAccess.prototype.execSQL = function (sql) {
        this._db.execSQL(sql);
    };
    SqliteAccess.prototype.beginTransact = function () {
        this._db.beginTransaction();
    };
    SqliteAccess.prototype.commit = function () {
        this._db.setTransactionSuccessful();
        this._db.endTransaction();
    };
    SqliteAccess.prototype.close = function () {
        this._db.close();
        this._db = null;
    };
    return SqliteAccess;
}());
function __processCursor(cursor) {
    return function () {
        var result = [];
        if (cursor.getCount() > 0) {
            while (cursor.moveToNext()) {
                result.push(__getRowValues(cursor, cursor.getColumnCount()));
            }
        }
        cursor.close();
        return result;
    };
}
/**
 * Process the sqlite cursor and return a js object with column/value
 * @param cursor
 * @param columnCount
 * @returns JS object like {[column:string]: any}
 */
function __getRowValues(cursor, columnCount) {
    var rowValue = {};
    var valueType = null;
    var columnName = '';
    for (var i = 0; i < columnCount; i++) {
        valueType = cursor.getType(i);
        columnName = cursor.getColumnName(i);
        switch (valueType) {
            case android.database.Cursor.FIELD_TYPE_INTEGER:
                rowValue[columnName] = cursor.getLong(i);
                break;
            case android.database.Cursor.FIELD_TYPE_FLOAT:
                rowValue[columnName] = cursor.getFloat(i);
                break;
            case android.database.Cursor.FIELD_TYPE_NULL:
                rowValue[columnName] = null;
                break;
            case android.database.Cursor.FIELD_TYPE_BLOB:
                rowValue[columnName] = cursor.getBlob(i);
                break;
            case android.database.Cursor.FIELD_TYPE_STRING:
                rowValue[columnName] = cursor.getString(i);
                break;
        }
    }
    return rowValue;
}
function __openCreateDataBase(dbName, mode) {
    if (dbName === ":memory:") {
        return android.database.sqlite.SQLiteDatabase.create(null);
    }
    mode = mode | android.database.sqlite.SQLiteDatabase.CREATE_IF_NECESSARY;
    return android.database.sqlite.SQLiteDatabase.openDatabase(dbName, null, mode);
}
function __objectArrayToStringArray(params) {
    if (!params)
        return null;
    var stringArray = [];
    for (var key in params) {
        stringArray.push(params[key] && params[key].toString() || null);
    }
    return stringArray;
}
function __mapToContentValues(values) {
    var contentValues = new android.content.ContentValues();
    for (var key in values) {
        if (values.hasOwnProperty(key) && values[key]) {
            contentValues.put(key, values[key]);
        }
        else {
            contentValues.putNull(key);
        }
    }
    return contentValues;
}
function builder(dbName) {
    return new SqliteAccess(__openCreateDataBase(dbName, android.database.sqlite.SQLiteDatabase.OPEN_READWRITE));
}
exports.builder = builder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3FsaXRlLWFjY2Vzcy5hbmRyb2lkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3FsaXRlLWFjY2Vzcy5hbmRyb2lkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUE7SUFHSSxzQkFBWSxFQUEwQztRQUNsRCxJQUFJLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBRUQsNkJBQU0sR0FBTixVQUFPLEtBQWEsRUFBRSxNQUErQjtRQUNqRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBRUQsOEJBQU8sR0FBUCxVQUFRLEtBQWEsRUFBRSxNQUErQjtRQUNsRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN2RSxDQUFDO0lBRUQsNkJBQU0sR0FBTixVQUFPLEtBQWEsRUFBRSxNQUErQixFQUFFLFdBQW1CLEVBQUUsUUFBZTtRQUN2RixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsRUFBRSxXQUFXLEVBQUUsMEJBQTBCLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNuSCxDQUFDO0lBRUQsNkJBQU0sR0FBTixVQUFPLEtBQWEsRUFBRSxXQUFtQixFQUFFLFFBQWU7UUFDdEQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLDBCQUEwQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUVELDZCQUFNLEdBQU4sVUFBTyxHQUFXLEVBQUUsTUFBYTtRQUM3QixJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDaEIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFTLE9BQU8sRUFBRSxLQUFLO1lBQ3RDLElBQUksTUFBTSxHQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSwwQkFBMEIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3ZFLElBQUk7Z0JBQ0EsSUFBTSxlQUFlLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNoRCxJQUFNLE1BQU0sR0FBRyxlQUFlLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ25CO1lBQUMsT0FBTSxFQUFFLEVBQUU7Z0JBQ1IsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO2FBQ1o7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCw0QkFBSyxHQUFMLFVBQU0sS0FBYSxFQUFFLE9BQWtCLEVBQUUsU0FBa0IsRUFBRSxhQUFxQixFQUFFLE9BQWdCLEVBQUUsT0FBZ0IsRUFBRSxLQUFjO1FBQ2xJLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQztRQUNoQixPQUFPLElBQUksT0FBTyxDQUFDLFVBQVMsT0FBTyxFQUFFLEtBQUs7WUFDdEMsSUFBSSxNQUFNLEdBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsMEJBQTBCLENBQUMsYUFBYSxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMxSCxJQUFJO2dCQUNBLElBQU0sZUFBZSxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDaEQsSUFBTSxNQUFNLEdBQUcsZUFBZSxFQUFFLENBQUM7Z0JBQ2pDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUNuQjtZQUFDLE9BQU0sRUFBRSxFQUFFO2dCQUNSLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTthQUNaO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsOEJBQU8sR0FBUCxVQUFRLEdBQVc7UUFDZixJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBRUQsb0NBQWEsR0FBYjtRQUNJLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBRUQsNkJBQU0sR0FBTjtRQUNJLElBQUksQ0FBQyxHQUFHLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRCw0QkFBSyxHQUFMO1FBQ0ksSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztJQUNwQixDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBcEVELElBb0VDO0FBR0QsU0FBUyxlQUFlLENBQUMsTUFBK0I7SUFDcEQsT0FBTztRQUNILElBQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDdkIsT0FBUSxNQUFNLENBQUMsVUFBVSxFQUFFLEVBQUc7Z0JBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUUsY0FBYyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBRSxDQUFDO2FBQ2xFO1NBQ0o7UUFDRCxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDLENBQUE7QUFDTCxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxTQUFTLGNBQWMsQ0FBQyxNQUErQixFQUFFLFdBQWtCO0lBQ3ZFLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUNsQixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUM7SUFDckIsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDbEMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsVUFBVSxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckMsUUFBUSxTQUFTLEVBQUU7WUFDZixLQUFLLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGtCQUFrQjtnQkFDM0MsUUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pDLE1BQU07WUFDVixLQUFLLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGdCQUFnQjtnQkFDekMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLE1BQU07WUFDVixLQUFLLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGVBQWU7Z0JBQ3hDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQzVCLE1BQU07WUFDVixLQUFLLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGVBQWU7Z0JBQ3hDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6QyxNQUFNO1lBQ1YsS0FBSyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUI7Z0JBQzFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMzQyxNQUFNO1NBQ2I7S0FDSjtJQUNELE9BQU8sUUFBUSxDQUFDO0FBQ3BCLENBQUM7QUFHRCxTQUFTLG9CQUFvQixDQUFDLE1BQWMsRUFBRSxJQUFZO0lBQ3RELElBQUksTUFBTSxLQUFLLFVBQVUsRUFBRTtRQUN2QixPQUFPLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDOUQ7SUFFRCxJQUFJLEdBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxtQkFBbUIsQ0FBQztJQUMxRSxPQUFPLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNuRixDQUFDO0FBRUQsU0FBUywwQkFBMEIsQ0FBQyxNQUFrQjtJQUNsRCxJQUFJLENBQUMsTUFBTTtRQUFFLE9BQU8sSUFBSSxDQUFDO0lBRXpCLElBQUksV0FBVyxHQUFpQixFQUFFLENBQUM7SUFDbkMsS0FBSSxJQUFJLEdBQUcsSUFBSSxNQUFNLEVBQUU7UUFDbkIsV0FBVyxDQUFDLElBQUksQ0FBRSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxJQUFJLElBQUksQ0FBRSxDQUFDO0tBQ3JFO0lBQ0QsT0FBTyxXQUFXLENBQUM7QUFDdkIsQ0FBQztBQUVELFNBQVMsb0JBQW9CLENBQUMsTUFBK0I7SUFDekQsSUFBSSxhQUFhLEdBQUcsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3hELEtBQUssSUFBTSxHQUFHLElBQUksTUFBTSxFQUFFO1FBQ3RCLElBQUksTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDM0MsYUFBYSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDdkM7YUFBTTtZQUNILGFBQWEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDOUI7S0FDSjtJQUNELE9BQU8sYUFBYSxDQUFDO0FBQ3pCLENBQUM7QUFFRCxTQUFnQixPQUFPLENBQUMsTUFBYztJQUNsQyxPQUFPLElBQUksWUFBWSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztBQUNqSCxDQUFDO0FBRkQsMEJBRUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJRGF0YWJhc2UgfSBmcm9tICcuL2NvbW1vbi9JRGF0YWJhc2UnO1xuXG5jbGFzcyBTcWxpdGVBY2Nlc3MgaW1wbGVtZW50cyBJRGF0YWJhc2Uge1xuICAgIFxuICAgIHByaXZhdGUgX2RiOiBhbmRyb2lkLmRhdGFiYXNlLnNxbGl0ZS5TUUxpdGVEYXRhYmFzZTtcbiAgICBjb25zdHJ1Y3RvcihkYjogYW5kcm9pZC5kYXRhYmFzZS5zcWxpdGUuU1FMaXRlRGF0YWJhc2UpIHtcbiAgICAgICAgdGhpcy5fZGIgPSBkYjtcbiAgICB9XG5cbiAgICBpbnNlcnQodGFibGU6IHN0cmluZywgdmFsdWVzOiB7IFtrZXk6IHN0cmluZ106IGFueTsgfSk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYi5pbnNlcnQodGFibGUsIG51bGwsIF9fbWFwVG9Db250ZW50VmFsdWVzKHZhbHVlcykpO1xuICAgIH0gICAgXG4gICAgXG4gICAgcmVwbGFjZSh0YWJsZTogc3RyaW5nLCB2YWx1ZXM6IHsgW2tleTogc3RyaW5nXTogYW55OyB9KTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RiLnJlcGxhY2UodGFibGUsIG51bGwsIF9fbWFwVG9Db250ZW50VmFsdWVzKHZhbHVlcykpO1xuICAgIH1cblxuICAgIHVwZGF0ZSh0YWJsZTogc3RyaW5nLCB2YWx1ZXM6IHsgW2tleTogc3RyaW5nXTogYW55OyB9LCB3aGVyZUNsYXVzZTogc3RyaW5nLCB3aGVyZUFyczogYW55W10pOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGIudXBkYXRlKHRhYmxlLCBfX21hcFRvQ29udGVudFZhbHVlcyh2YWx1ZXMpLCB3aGVyZUNsYXVzZSwgX19vYmplY3RBcnJheVRvU3RyaW5nQXJyYXkod2hlcmVBcnMpKTtcbiAgICB9XG5cbiAgICBkZWxldGUodGFibGU6IHN0cmluZywgd2hlcmVDbGF1c2U6IHN0cmluZywgd2hlcmVBcnM6IGFueVtdKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RiLmRlbGV0ZSh0YWJsZSwgd2hlcmVDbGF1c2UsIF9fb2JqZWN0QXJyYXlUb1N0cmluZ0FycmF5KHdoZXJlQXJzKSk7XG4gICAgfVxuXG4gICAgc2VsZWN0KHNxbDogc3RyaW5nLCBwYXJhbXM6IGFueVtdKTogUHJvbWlzZTxBcnJheTxhbnk+PiB7XG4gICAgICAgIGNvbnN0IG1lID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIGVycm9yKSB7XG4gICAgICAgICAgICBsZXQgY3Vyc29yID0gIG1lLl9kYi5yYXdRdWVyeShzcWwsIF9fb2JqZWN0QXJyYXlUb1N0cmluZ0FycmF5KHBhcmFtcykpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b0FycmF5T2ZPYmplY3QgPSBfX3Byb2Nlc3NDdXJzb3IoY3Vyc29yKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0b0FycmF5T2ZPYmplY3QoKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9IGNhdGNoKGV4KSB7XG4gICAgICAgICAgICAgICAgZXJyb3IoZXgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHF1ZXJ5KHRhYmxlOiBzdHJpbmcsIGNvbHVtbnM/OiBzdHJpbmdbXSwgc2VsZWN0aW9uPzogc3RyaW5nLCBzZWxlY3Rpb25BcmdzPzogYW55W10sIGdyb3VwQnk/OiBzdHJpbmcsIG9yZGVyQnk/OiBzdHJpbmcsIGxpbWl0Pzogc3RyaW5nKTogUHJvbWlzZTxBcnJheTxhbnk+PiB7XG4gICAgICAgIGNvbnN0IG1lID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIGVycm9yKSB7XG4gICAgICAgICAgICBsZXQgY3Vyc29yID0gIG1lLl9kYi5xdWVyeSh0YWJsZSwgY29sdW1ucywgc2VsZWN0aW9uLCBfX29iamVjdEFycmF5VG9TdHJpbmdBcnJheShzZWxlY3Rpb25BcmdzKSwgZ3JvdXBCeSwgb3JkZXJCeSwgbGltaXQpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b0FycmF5T2ZPYmplY3QgPSBfX3Byb2Nlc3NDdXJzb3IoY3Vyc29yKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0b0FycmF5T2ZPYmplY3QoKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9IGNhdGNoKGV4KSB7XG4gICAgICAgICAgICAgICAgZXJyb3IoZXgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGV4ZWNTUUwoc3FsOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fZGIuZXhlY1NRTChzcWwpO1xuICAgIH1cblxuICAgIGJlZ2luVHJhbnNhY3QoKSB7XG4gICAgICAgIHRoaXMuX2RiLmJlZ2luVHJhbnNhY3Rpb24oKTtcbiAgICB9XG5cbiAgICBjb21taXQoKSB7XG4gICAgICAgIHRoaXMuX2RiLnNldFRyYW5zYWN0aW9uU3VjY2Vzc2Z1bCgpO1xuICAgICAgICB0aGlzLl9kYi5lbmRUcmFuc2FjdGlvbigpO1xuICAgIH1cblxuICAgIGNsb3NlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9kYi5jbG9zZSgpO1xuICAgICAgICB0aGlzLl9kYiA9IG51bGw7XG4gICAgfVxufVxuXG5cbmZ1bmN0aW9uIF9fcHJvY2Vzc0N1cnNvcihjdXJzb3I6IGFuZHJvaWQuZGF0YWJhc2UuQ3Vyc29yKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgICAgIGlmIChjdXJzb3IuZ2V0Q291bnQoKSA+IDApIHtcbiAgICAgICAgICAgIHdoaWxlICggY3Vyc29yLm1vdmVUb05leHQoKSApIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCggX19nZXRSb3dWYWx1ZXMoY3Vyc29yLCBjdXJzb3IuZ2V0Q29sdW1uQ291bnQoKSkgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjdXJzb3IuY2xvc2UoKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvY2VzcyB0aGUgc3FsaXRlIGN1cnNvciBhbmQgcmV0dXJuIGEganMgb2JqZWN0IHdpdGggY29sdW1uL3ZhbHVlXG4gKiBAcGFyYW0gY3Vyc29yIFxuICogQHBhcmFtIGNvbHVtbkNvdW50IFxuICogQHJldHVybnMgSlMgb2JqZWN0IGxpa2Uge1tjb2x1bW46c3RyaW5nXTogYW55fVxuICovXG5mdW5jdGlvbiBfX2dldFJvd1ZhbHVlcyhjdXJzb3I6IGFuZHJvaWQuZGF0YWJhc2UuQ3Vyc29yLCBjb2x1bW5Db3VudDpudW1iZXIpOiBhbnkge1xuICAgIGxldCByb3dWYWx1ZSA9IHt9O1xuICAgIGxldCB2YWx1ZVR5cGUgPSBudWxsO1xuICAgIGxldCBjb2x1bW5OYW1lID0gJyc7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2x1bW5Db3VudDsgaSsrKSB7XG4gICAgICAgIHZhbHVlVHlwZSA9IGN1cnNvci5nZXRUeXBlKGkpO1xuICAgICAgICBjb2x1bW5OYW1lID0gY3Vyc29yLmdldENvbHVtbk5hbWUoaSk7XG4gICAgICAgIHN3aXRjaCAodmFsdWVUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIGFuZHJvaWQuZGF0YWJhc2UuQ3Vyc29yLkZJRUxEX1RZUEVfSU5URUdFUjogXG4gICAgICAgICAgICAgICAgcm93VmFsdWVbY29sdW1uTmFtZV0gPSBjdXJzb3IuZ2V0TG9uZyhpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgYW5kcm9pZC5kYXRhYmFzZS5DdXJzb3IuRklFTERfVFlQRV9GTE9BVDogXG4gICAgICAgICAgICAgICAgcm93VmFsdWVbY29sdW1uTmFtZV0gPSBjdXJzb3IuZ2V0RmxvYXQoaSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGFuZHJvaWQuZGF0YWJhc2UuQ3Vyc29yLkZJRUxEX1RZUEVfTlVMTDpcbiAgICAgICAgICAgICAgICByb3dWYWx1ZVtjb2x1bW5OYW1lXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGFuZHJvaWQuZGF0YWJhc2UuQ3Vyc29yLkZJRUxEX1RZUEVfQkxPQjpcbiAgICAgICAgICAgICAgICByb3dWYWx1ZVtjb2x1bW5OYW1lXSA9IGN1cnNvci5nZXRCbG9iKGkpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBhbmRyb2lkLmRhdGFiYXNlLkN1cnNvci5GSUVMRF9UWVBFX1NUUklORzogXG4gICAgICAgICAgICAgICAgcm93VmFsdWVbY29sdW1uTmFtZV0gPSBjdXJzb3IuZ2V0U3RyaW5nKGkpOyAgICBcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcm93VmFsdWU7XG59XG5cblxuZnVuY3Rpb24gX19vcGVuQ3JlYXRlRGF0YUJhc2UoZGJOYW1lOiBzdHJpbmcsIG1vZGU6IG51bWJlcikge1xuICAgIGlmIChkYk5hbWUgPT09IFwiOm1lbW9yeTpcIikge1xuICAgICAgICByZXR1cm4gYW5kcm9pZC5kYXRhYmFzZS5zcWxpdGUuU1FMaXRlRGF0YWJhc2UuY3JlYXRlKG51bGwpO1xuICAgIH1cblxuICAgIG1vZGUgPSAgbW9kZSB8IGFuZHJvaWQuZGF0YWJhc2Uuc3FsaXRlLlNRTGl0ZURhdGFiYXNlLkNSRUFURV9JRl9ORUNFU1NBUlk7XG4gICAgcmV0dXJuIGFuZHJvaWQuZGF0YWJhc2Uuc3FsaXRlLlNRTGl0ZURhdGFiYXNlLm9wZW5EYXRhYmFzZShkYk5hbWUsIG51bGwsIG1vZGUpO1xufVxuXG5mdW5jdGlvbiBfX29iamVjdEFycmF5VG9TdHJpbmdBcnJheShwYXJhbXM6IEFycmF5PGFueT4pIHtcbiAgICBpZiAoIXBhcmFtcykgcmV0dXJuIG51bGw7XG5cbiAgICBsZXQgc3RyaW5nQXJyYXk6QXJyYXk8c3RyaW5nPiA9IFtdO1xuICAgIGZvcihsZXQga2V5IGluIHBhcmFtcykge1xuICAgICAgICBzdHJpbmdBcnJheS5wdXNoKCBwYXJhbXNba2V5XSAmJiBwYXJhbXNba2V5XS50b1N0cmluZygpIHx8IG51bGwgKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZ0FycmF5O1xufVxuXG5mdW5jdGlvbiBfX21hcFRvQ29udGVudFZhbHVlcyh2YWx1ZXM6IHsgW2tleTogc3RyaW5nXTogYW55OyB9KSB7XG4gICAgbGV0IGNvbnRlbnRWYWx1ZXMgPSBuZXcgYW5kcm9pZC5jb250ZW50LkNvbnRlbnRWYWx1ZXMoKTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiB2YWx1ZXMpIHtcbiAgICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIHZhbHVlc1trZXldKSB7XG4gICAgICAgICAgICBjb250ZW50VmFsdWVzLnB1dChrZXksIHZhbHVlc1trZXldKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRlbnRWYWx1ZXMucHV0TnVsbChrZXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50VmFsdWVzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRlcihkYk5hbWU6IHN0cmluZykgOiBTcWxpdGVBY2Nlc3Mge1xuICAgIHJldHVybiBuZXcgU3FsaXRlQWNjZXNzKF9fb3BlbkNyZWF0ZURhdGFCYXNlKGRiTmFtZSwgYW5kcm9pZC5kYXRhYmFzZS5zcWxpdGUuU1FMaXRlRGF0YWJhc2UuT1BFTl9SRUFEV1JJVEUpKTtcbn0iXX0=